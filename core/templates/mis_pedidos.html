{% extends 'plantilla.html' %}
{% block content %}

<div class="container py-4">
  <span>Pedidos Aprobados</span>

  {% if pedidos %}
  <ul class="list-group">
    {% for pedido in pedidos %}
    <li class="list-group-item d-flex flex-column gap-2">
      <div class="d-flex justify-content-between align-items-center">
        <strong>Pedido #{{ pedido.id }}</strong>
        <span class="text-muted">{{ pedido.fecha_creacion }}</span>
      </div>

      {% if pedido.estado == 'ACEPTADO' %}
      <a href="{% url 'pagar_pedido' pedido.id %}" class="btn btn-primary btn-sm w-25">Pagar</a>
      {% endif %}

      <div>
        <strong>Estado:</strong> {{ pedido.get_estado_display }}
        <br>
        <small class="text-secondary">
          {% if pedido.estado == 'PENDIENTE' %}
          Estamos esperando que el vendedor revise y apruebe tu pedido.
          {% elif pedido.estado == 'RECHAZADO' %}
          Este pedido fue rechazado por el vendedor.
          {% elif pedido.estado == 'ACEPTADO' %}
          Tu pedido fue aprobado. Ahora puedes proceder a elegir entrega y pagar.
          {% elif pedido.estado == 'EN_ESPERA_PAGO' %}
          Hemos recibido tu solicitud. Esperamos el pago o su confirmaci칩n.
          {% elif pedido.estado == 'PAGO_CONFIRMADO' %}
          El contador ha verificado tu pago. Pronto se preparar치 tu pedido.
          {% elif pedido.estado == 'LISTO_DESPACHO' %}
          El pedido fue confirmado y est치 listo para ser preparado.
          {% elif pedido.estado == 'ENTREGADO' %}
          El bodeguero entreg칩 el pedido. Gracias por tu compra.
          {% elif pedido.estado == 'VENTA_FINALIZADA' %}
          Tu pedido ha sido completado exitosamente.
          {% else %}
          Estado desconocido.
          {% endif %}
        </small>
        <div>
          <button data-bs-toggle="modal" data-bs-target="#modalPedido{{ pedido.id }}">
            Ver productos
          </button>
          <div class="modal fade" id="modalPedido{{ pedido.id }}" tabindex="-1"
            aria-labelledby="modalLabel{{ pedido.id }}" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalLabel{{ pedido.id }}">Productos del Pedido #{{ pedido.id }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Subtotal</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for detalle in pedido.detalles.all %}
                      <tr>
                        <td>{{ detalle.producto.descripcion }}</td>
                        <td>{{ detalle.cantidad }}</td>
                        <td>${{ detalle.precio_unitario }}</td>
                        <td>${{ detalle.precio_unitario|floatformat:0|floatformat:"0"|add:""|floatformat:"0" }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>

                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p>No tienes pedidos aprobados pendientes de pago.</p>
  {% endif %}
</div>

{% endblock %}